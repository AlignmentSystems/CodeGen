/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/5.4/userguide/java_library_plugin.html
 */

plugins {
    // Apply the java-library plugin to add support for Java Library
    id 'java-library'
    id 'com.github.johnrengelman.shadow' version '5.1.0' 
}


sourceSets {
	main {
		java {
			srcDir 'src'
		}
	}
}

repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
   mavenCentral()
}



def String versionBuild
def versionPropsFile = file('version.properties')


 if (versionPropsFile.canRead()) {
        def Properties versionProps = new Properties()
        versionProps.load(new FileInputStream(versionPropsFile))
        versionBuild = versionProps['VERSION_BUILD'].toInteger()
    } else {
        throw new FileNotFoundException("Could not read version.properties!")
    }


ext.autoIncrementBuildNumber = {

        if (versionPropsFile.canRead()) {
            def Properties versionProps = new Properties()
            versionProps.load(new FileInputStream(versionPropsFile))
            versionBuild = versionProps['VERSION_BUILD'].toInteger() + 1
            versionProps['VERSION_BUILD'] = versionBuild.toString()
            versionProps.store(versionPropsFile.newWriter(), null)
        } else {
            throw new FileNotFoundException("Could not read version.properties!")
        }
    }



java{
	targetCompatibility  = JavaVersion.toVersion(10)
	sourceCompatibility  = JavaVersion.toVersion(10)
}

dependencies {
	// https://mvnrepository.com/artifact/org.apache.velocity/velocity
	compile group: 'org.apache.velocity', name: 'velocity-engine-core', version: '2.2'
	compile group: 'org.apache.velocity.tools', name: 'velocity-tools-generic', version: '3.0'
	implementation 'ch.qos.logback:logback-core:1.1.3'
	implementation 'ch.qos.logback:logback-classic:1.1.3'
	implementation 'org.slf4j:slf4j-api:1.7.21'	
}


def String dot = '.'
def String semVer = '0.9.0'

shadowJar{
	autoIncrementBuildNumber()
	archiveClassifier = semVer
	manifest{
			attributes 'Specification-Title' : 'Alignment Systems Class Generator'
			attributes 'Main-Class':'com.alignmentsystems.classgen.Worker'
			attributes 'class-path':'.'
			attributes 'Version': new StringBuilder()
					   .append( semVer )
                       .append( dot )
                       .append( versionBuild )
                       .toString()
	}
 }